name: "DEPLOY RH FRONTEND"

on:
  push:
    branches: [nuevo]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Debug – Show structure
        run: |
          echo "=== Directorio actual ==="
          pwd
          echo "=== Contenido ==="
          ls -la
          echo "=== Buscando package.json ==="
          find . -name "package.json" -type f || echo "No se encontró ninguno"

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Set project directory
        id: setup
        run: |
          if [ -f "RH_frontend/package.json" ]; then
            echo "DIR=RH_frontend" >> $GITHUB_OUTPUT
            echo "✔ Encontrado package.json en RH_frontend/"
          else
            echo "❌ ERROR: No se encontró RH_frontend/package.json"
            exit 1
          fi

      - name: Install dependencies
        run: |
          cd "${{ steps.setup.outputs.DIR }}"
          echo "📦 Instalando dependencias en: $(pwd)"
          npm install --legacy-peer-deps

      - name: Build
        run: |
          cd "${{ steps.setup.outputs.DIR }}"
          echo "🏗 Ejecutando build en: $(pwd)"
          npm run build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: "RH_frontend/dist"
          branch: gh-pages
