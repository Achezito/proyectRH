name: Deploy to GitHub Pages

on:
  push:
    branches: [nuevo]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Find package.json
        id: find_package
        run: |
          echo "Buscando package.json..."
          # Busca en todas partes
          find . -name "package.json" -type f
          # Toma el primero que encuentre
          PKG_PATH=$(find . -name "package.json" -type f | head -1)
          if [ -z "$PKG_PATH" ]; then
            echo "ERROR: No se encontró package.json"
            echo "Estructura actual:"
            ls -la
            ls -la */
            exit 1
          fi
          echo "✅ Encontrado en: $PKG_PATH"
          # Obtiene el directorio
          PKG_DIR=$(dirname "$PKG_PATH")
          echo "📁 Directorio: $PKG_DIR"
          # Guarda para usar en otros steps
          echo "PKG_DIR=$PKG_DIR" >> $GITHUB_OUTPUT

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Install dependencies
        run: |
          echo "Instalando en: ${{ steps.find_package.outputs.PKG_DIR }}"
          cd "${{ steps.find_package.outputs.PKG_DIR }}"
          npm install --legacy-peer-deps

      - name: Build
        run: |
          echo "Build en: ${{ steps.find_package.outputs.PKG_DIR }}"
          cd "${{ steps.find_package.outputs.PKG_DIR }}"
          npm run build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: "${{ steps.find_package.outputs.PKG_DIR }}/dist"
          branch: gh-pages
