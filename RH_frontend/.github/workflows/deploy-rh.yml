name: "DEPLOY RH FRONTEND"

on:
  push:
    branches: [nuevo]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Debug - Show structure
        run: |
          echo "=== MOSTRANDO TODO ==="
          pwd
          ls -la
          echo "=== BUSCANDO package.json ==="
          find . -name "package.json" -type f 2>/dev/null || echo "No encontrado"
          echo "=== LISTA RECURSIVA ==="
          find . -type f -name "*.json" | head -10

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"

      - name: Find project directory
        id: setup
        run: |
          echo "=== Detectando ubicación de package.json ==="

          # 1. raíz
          if [ -f "package.json" ]; then
            echo "DIR=." >> $GITHUB_OUTPUT
            echo "Encontrado en raíz"
            exit 0
          fi

          # 2. rh_frontend
          if [ -f "rh_frontend/package.json" ]; then
            echo "DIR=rh_frontend" >> $GITHUB_OUTPUT
            echo "Encontrado en rh_frontend/"
            exit 0
          fi

          # 3. rh-frontend (con guion)
          if [ -f "rh-frontend/package.json" ]; then
            echo "DIR=rh-frontend" >> $GITHUB_OUTPUT
            echo "Encontrado en rh-frontend/"
            exit 0
          fi

          # 4. RH_frontend (mayúsculas)
          if [ -f "RH_frontend/package.json" ]; then
            echo "DIR=RH_frontend" >> $GITHUB_OUTPUT
            echo "Encontrado en RH_frontend/"
            exit 0
          fi

          echo "❌ ERROR: No se encontró package.json en ninguna ruta conocida"
          find . -maxdepth 4 -type f -name "package.json"
          exit 1

      - name: Debug output chosen directory
        run: |
          echo "=== Carpeta detectada ==="
          echo "DIR: '${{ steps.setup.outputs.DIR }}'"
          ls -la
          echo "=== Revisando carpetas ==="
          ls -la rh_frontend 2>/dev/null || echo "No existe rh_frontend/"
          ls -la rh-frontend 2>/dev/null || echo "No existe rh-frontend/"
          ls -la RH_frontend 2>/dev/null || echo "No existe RH_frontend/"

      - name: Install dependencies
        run: |
          cd "${{ steps.setup.outputs.DIR }}"
          echo "=== Instalando dependencias en $(pwd) ==="
          npm install --legacy-peer-deps

      - name: Build
        run: |
          cd "${{ steps.setup.outputs.DIR }}"
          echo "=== Ejecutando build en $(pwd) ==="
          npm run build

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: "${{ steps.setup.outputs.DIR }}/dist"
          branch: gh-pages
